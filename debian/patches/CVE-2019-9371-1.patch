Partial Backport of:

From f00890eecdf8365ea125ac16769a83aa6b68792d Mon Sep 17 00:00:00 2001
From: James Zern <jzern@google.com>
Date: Tue, 11 Dec 2018 18:06:20 -0800
Subject: [PATCH] update libwebm to libwebm-1.0.0.27-352-g6ab9fcf

https://chromium.googlesource.com/webm/libwebm/+log/af81f26..6ab9fcf

Change-Id: I9d56e1fbaba9b96404b4fbabefddc1a85b79c25d
---
 third_party/libwebm/AUTHORS.TXT              |  8 +--
 third_party/libwebm/README.libvpx            |  2 +-
 third_party/libwebm/common/file_util.cc      |  2 +-
 third_party/libwebm/common/webmids.h         |  1 +
 third_party/libwebm/mkvmuxer/mkvmuxer.cc     | 52 +++++++++++++++-----
 third_party/libwebm/mkvmuxer/mkvmuxer.h      |  5 +-
 third_party/libwebm/mkvmuxer/mkvmuxerutil.cc |  5 +-
 third_party/libwebm/mkvmuxer/mkvwriter.cc    |  2 +
 third_party/libwebm/mkvparser/mkvparser.cc   | 19 +++++--
 third_party/libwebm/mkvparser/mkvparser.h    |  6 ++-
 third_party/libwebm/mkvparser/mkvreader.cc   |  2 +
 11 files changed, 75 insertions(+), 29 deletions(-)

--- a/third_party/libwebm/mkvparser/mkvparser.cc
+++ b/third_party/libwebm/mkvparser/mkvparser.cc
@@ -5317,7 +5317,7 @@ long VideoTrack::Parse(Segment* pSegment
   const long long stop = pos + s.size;
 
   Colour* colour = NULL;
-  Projection* projection = NULL;
+  std::unique_ptr<Projection> projection_ptr;
 
   while (pos < stop) {
     long long id, size;
@@ -5369,8 +5369,12 @@ long VideoTrack::Parse(Segment* pSegment
       if (!Colour::Parse(pReader, pos, size, &colour))
         return E_FILE_FORMAT_INVALID;
     } else if (id == libwebm::kMkvProjection) {
-      if (!Projection::Parse(pReader, pos, size, &projection))
+      Projection* projection = NULL;
+      if (!Projection::Parse(pReader, pos, size, &projection)) {
         return E_FILE_FORMAT_INVALID;
+      } else {
+        projection_ptr.reset(projection);
+      }
     }
 
     pos += size;  // consume payload
@@ -5402,7 +5406,7 @@ long VideoTrack::Parse(Segment* pSegment
   pTrack->m_stereo_mode = stereo_mode;
   pTrack->m_rate = rate;
   pTrack->m_colour = colour;
-  pTrack->m_projection = projection;
+  pTrack->m_projection = projection_ptr.release();
 
   pResult = pTrack;
   return 0;  // success
